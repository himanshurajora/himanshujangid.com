<!doctype html><html><head><title>Continuous Aggregation In Time Scale</title><base href="../"><meta id="root-path" root-path="../"><link rel="icon" sizes="96x96" href="https://publish-01.obsidian.md/access/f786db9fac45774fa4f0d8112e232d67/favicon-96x96.png"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes,minimum-scale=1,maximum-scale=5"><meta charset="UTF-8"><link rel="stylesheet" href="lib/styles/obsidian-styles.css"><link rel="stylesheet" href="lib/styles/theme.css"><link rel="stylesheet" href="lib/styles/plugin-styles.css"><link rel="stylesheet" href="lib/styles/snippets.css"><link rel="stylesheet" href="lib/styles/generated-styles.css"><style></style><script type="module" src="lib/scripts/graph_view.js"></script><script src="lib/scripts/graph_wasm.js"></script><script src="lib/scripts/tinycolor.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.2.4/pixi.min.js" integrity="sha512-Ch/O6kL8BqUwAfCF7Ie5SX1Hin+BJgYH4pNjRqXdTEqMsis1TUYg+j6nnI9uduPjGaj7DN4UKCZgpvoExt6dkw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><script src="lib/scripts/webpage.js"></script><script src="lib/scripts/generated.js"></script></head><body class="mod-linux show-inline-title theme-dark loading"><div class="webpage-container"><div class="sidebar-left sidebar"><div class="sidebar-container"><div class="sidebar-sizer"><div class="sidebar-content-positioner"><div class="sidebar-content"><div><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="tree-container file-tree mod-nav-indicator" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">portfolio</span><button class="clickable-icon collapse-tree-button is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area"><div class="tree-item mod-tree-folder mod-collapsible is-collapsed" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">assets</span></a></div><div class="tree-item-children" style="display:none"><div class="tree-item mod-tree-folder mod-collapsible is-collapsed" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">images</span></a></div><div class="tree-item-children" style="display:none"><div class="tree-item mod-tree-file" data-depth="3"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="assets/images/logo.png"><span class="tree-item-title">logo</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="3"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="assets/images/logo-sm.png"><span class="tree-item-title">logo-sm</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="3"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="assets/images/me.jpg"><span class="tree-item-title">me</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="3"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="assets/images/me-2.jpg"><span class="tree-item-title">me-2</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="3"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="assets/images/me-2-full.jpg"><span class="tree-item-title">me-2-full</span></a></div><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-tree-folder mod-collapsible is-collapsed" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">snippets</span></a></div><div class="tree-item-children" style="display:none"><div class="tree-item mod-tree-file" data-depth="3"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="assets/snippets/shapes.png"><span class="tree-item-title">shapes</span></a></div><div class="tree-item-children"></div></div></div></div></div></div><div class="tree-item mod-tree-folder mod-collapsible is-collapsed" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">blogs</span></a></div><div class="tree-item-children" style="display:none"><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="blogs/continuous-aggregation-in-time-scale.html"><span class="tree-item-title">Continuous Aggregation In Time Scale</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="blogs/markdown-editor-in-react.html"><span class="tree-item-title">Markdown editor in react</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="blogs/readme.html"><span class="tree-item-title">README</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="blogs/the-hundred-things-principle.html"><span class="tree-item-title">The Hundred Things Principle</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="blogs/tmux-for-productivity.html"><span class="tree-item-title">Tmux for productivity</span></a></div><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-tree-folder mod-collapsible is-collapsed" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">legal</span></a></div><div class="tree-item-children" style="display:none"><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="legal/privacy-policy.html"><span class="tree-item-title">privacy-policy</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="legal/return-and-refund-policy.html"><span class="tree-item-title">return-and-refund-policy</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="legal/terms-and-conditions.html"><span class="tree-item-title">terms-and-conditions</span></a></div><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-tree-folder mod-collapsible is-collapsed" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">neosanatan</span></a></div><div class="tree-item-children" style="display:none"><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="neosanatan/readme.html"><span class="tree-item-title">README</span></a></div><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-tree-folder mod-collapsible is-collapsed" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">progess</span></a></div><div class="tree-item-children" style="display:none"><div class="tree-item mod-tree-folder mod-collapsible is-collapsed" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">week-wise</span></a></div><div class="tree-item-children" style="display:none"><div class="tree-item mod-tree-file" data-depth="3"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="progess/week-wise/2023-w28.html"><span class="tree-item-title">2023-W28</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="3"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="progess/week-wise/2023-w29.html"><span class="tree-item-title">2023-W29</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="3"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="progess/week-wise/2023-w31.html"><span class="tree-item-title">2023-W31</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="3"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="progess/week-wise/readme.html"><span class="tree-item-title">README</span></a></div><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="progess/readme.html"><span class="tree-item-title">README</span></a></div><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-tree-folder mod-collapsible is-collapsed" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">projects</span></a></div><div class="tree-item-children" style="display:none"><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="projects/looking-for-contributors.html"><span class="tree-item-title">Looking for contributors</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="projects/projects-kanban.html"><span class="tree-item-title">Projects Kanban</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="projects/readme.html"><span class="tree-item-title">README</span></a></div><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-tree-folder mod-collapsible is-collapsed" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">rust</span></a></div><div class="tree-item-children" style="display:none"><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="rust/readme.html"><span class="tree-item-title">README</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="rust/writing-test-in-rust.html"><span class="tree-item-title">Writing Test in Rust</span></a></div><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-tree-folder mod-collapsible is-collapsed" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">snippets</span></a></div><div class="tree-item-children" style="display:none"><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="snippets/canvas-following-points.html"><span class="tree-item-title">Canvas following points</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="snippets/gulp-html-partial-and-live-server.html"><span class="tree-item-title">Gulp html partial and live server</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="snippets/how-to-prevent-circular-dependencies.html"><span class="tree-item-title">How to prevent circular dependencies</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="snippets/multi-generic-type-in-typescript.html"><span class="tree-item-title">Multi Generic type in typescript</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="snippets/preserve-cwd-in-gnome-terminal.html"><span class="tree-item-title">Preserve CWD in Gnome Terminal</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="snippets/readme.html"><span class="tree-item-title">README</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="2"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="snippets/yield-keyword-javascript-with-real-life-use-cases.html"><span class="tree-item-title">Yield Keyword JavaScript - With Real life use-cases</span></a></div><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="charts.html"><span class="tree-item-title">Charts</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="index.html"><span class="tree-item-title">index</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="readme.html"><span class="tree-item-title">README</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="things-to-checkout.html"><span class="tree-item-title">Things to Checkout</span></a></div><div class="tree-item-children"></div></div></div></div></div></div></div></div><div class="sidebar-gutter"><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div></div><div class="document-container show"><div class="markdown-preview-view markdown-rendered node-insert-event is-readable-line-width allow-fold-headings show-indentation-guide allow-fold-lists show-properties" style="tab-size:4"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section" style="min-height:5666px"><div class="markdown-preview-pusher" style="width:1px;height:.1px;margin-bottom:0"></div><div class="mod-header"><div class="inline-title" data-heading="Continuous Aggregation In Time Scale" id="Continuous_Aggregation_In_Time_Scale" style="display:block">Continuous Aggregation In Time Scale</div></div><div><p>Basic Questions and Their answers, ultimately leading to the solution.</p></div><div><hr></div><div><p>Q: Best way to aggregate and store time based data</p></div><div><p>The best way to aggregate and store time-based data depends on various factors, such as the volume of data, the frequency of updates, the required query and retrieval performance, and the specific needs of your application. However, here are some commonly used approaches:</p></div><div><ol><li data-line="0">Relational Databases: Relational databases like MySQL, PostgreSQL, or Oracle are widely used for storing time-based data. You can create a table with columns representing different attributes of the data, including a timestamp column. Indexing the timestamp column can improve query performance.</li><li data-line="2">Time-Series Databases: Time-series databases, such as InfluxDB, Prometheus, or TimescaleDB, are specifically designed for handling time-based data. These databases optimize storage and retrieval for time-series data, offering efficient compression and fast querying capabilities.</li><li data-line="4">Distributed File Systems: Distributed file systems like Apache Hadoop HDFS or Apache HBase can be suitable for storing large volumes of time-based data. They provide fault-tolerance and scalability, making them ideal for big data applications.</li><li data-line="6">Columnar Databases: Columnar databases like Apache Cassandra or Apache Parquet store data in a column-oriented format, which can be advantageous for time-series data. Columnar storage offers efficient compression and better query performance for specific columns.</li><li data-line="8">NoSQL Databases: NoSQL databases, such as MongoDB or Couchbase, provide flexible schemas and horizontal scalability. They can handle time-based data effectively, especially when the data has a variable structure or when you need to scale horizontally.</li><li data-line="10">Cloud-Based Solutions: Cloud platforms like Amazon Web Services (AWS), Google Cloud Platform (GCP), or Microsoft Azure offer managed database services specifically designed for time-series data. For example, AWS provides Amazon Timestream, GCP offers BigQuery, and Azure has Azure Time Series Insights.</li></ol></div><div><p>When selecting the best approach, consider factors like data size, query patterns, scalability requirements, and the capabilities and expertise of your development team. It's often helpful to prototype and benchmark different solutions to find the one that best fits your specific needs.</p></div><div><hr></div><div><p>Q: How can timescale help me to do that?</p></div><div><p>TimescaleDB is an open-source time-series database built on top of PostgreSQL. It extends PostgreSQL with additional features and optimizations specifically tailored for storing and querying time-series data. Here's how TimescaleDB can help you with aggregating and storing time-based data:</p></div><div><ol><li data-line="0">Time-Series Optimization: TimescaleDB automatically partitions data across time intervals, allowing for efficient storage and retrieval of time-series data. It provides hypertables, which are virtual tables that enable automatic partitioning based on time. This partitioning improves query performance by limiting the amount of data scanned for a given time range.</li><li data-line="2">Continuous Aggregation: TimescaleDB offers continuous aggregation, which allows you to precompute and store aggregated results at different time intervals (e.g., hourly, daily, weekly). This feature significantly speeds up queries that require aggregated data, as the results are readily available without the need for expensive calculations at query time.</li><li data-line="4">Advanced Indexing: TimescaleDB provides specialized indexing techniques optimized for time-series data. It includes time-based indexes like time-series indexes (B-trees) and compression-based indexes (chunked-based indexes). These indexes enable faster search and retrieval of data based on time ranges.</li><li data-line="6">SQL Compatibility: TimescaleDB is built on PostgreSQL, which means it offers full SQL support. You can use standard SQL queries to perform complex operations and analysis on your time-series data. It provides a familiar interface for developers and allows easy integration with existing applications.</li><li data-line="8">Scalability and High Availability: TimescaleDB can scale horizontally by adding more instances, leveraging the distributed capabilities of PostgreSQL. It also supports replication and high availability setups, ensuring data durability and fault tolerance.</li><li data-line="10">Ecosystem Integration: TimescaleDB integrates well with popular data processing and visualization tools like Grafana, Prometheus, and Apache Kafka. This allows you to build end-to-end data pipelines for collecting, storing, analyzing, and visualizing time-series data.</li></ol></div><div><p>TimescaleDB combines the power and flexibility of PostgreSQL with specialized optimizations for time-series data, making it a popular choice for handling time-based data at scale. Its features like automatic partitioning, continuous aggregation, and advanced indexing make it efficient and performant for storing and querying time-series data.</p></div><div><hr></div><div><p>Q: Can you tell me how continuous aggregation works in TimeScale with exapmles.</p></div><div><p>Certainly! Continuous aggregation is a powerful feature in TimescaleDB that allows you to precompute and store aggregated results at different time intervals. This feature significantly speeds up queries that require aggregated data, as the results are readily available without the need for expensive calculations at query time. Here's how continuous aggregation works in TimescaleDB:</p></div><div><ol><li data-line="0"><p>Creating a Hypertable: To enable continuous aggregation, you start by creating a hypertable, which is a virtual table in TimescaleDB that provides automatic partitioning based on time. You can define the hypertable by specifying the time column and other relevant columns for your time-series data.</p><p>For example, let's say you have a table named "sensor_data" with columns "timestamp," "sensor_id," and "value." To create a hypertable, you would execute the following SQL statement:</p></li></ol></div><div><pre class="language-sql" tabindex="0"><code class="language-sql is-loaded"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> sensor_data <span class="token punctuation">(</span>
<span class="token keyword">timestamp</span>   TIMESTAMPTZ       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
sensor_id   <span class="token keyword">INTEGER</span>           <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token keyword">value</span>       <span class="token keyword">DOUBLE</span> <span class="token keyword">PRECISION</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token comment">-- Additional columns... </span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- Create a hypertable on the 'timestamp' column </span>
<span class="token keyword">SELECT</span> create_hypertable<span class="token punctuation">(</span><span class="token string">'sensor_data'</span><span class="token punctuation">,</span> <span class="token string">'timestamp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><ul><li data-line="0">Defining Continuous Aggregates: Once you have a hypertable, you can define continuous aggregates that specify the aggregations you want to compute and store at different time intervals. Continuous aggregates are defined using SQL queries. For example, let's say you want to compute the average value of the sensor data every hour. You can define a continuous aggregate using the following SQL statement:<br></li></ul></div><div><pre class="language-sql" tabindex="0"><code class="language-sql is-loaded"><span class="token comment">-- Create a continuous aggregate to compute average value every hour </span>
<span class="token keyword">SELECT</span> add_continuous_aggregate_policy<span class="token punctuation">(</span><span class="token string">'sensor_data'</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token string">'1 hour'</span><span class="token punctuation">,</span> <span class="token string">'avg_value_hourly'</span><span class="token punctuation">,</span> <span class="token string">'SELECT sensor_id, avg(value) FROM sensor_data GROUP BY sensor_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><ul><li data-line="0">In this example, the continuous aggregate is named "avg_value_hourly," and it calculates the average value for each sensor ID every hour.<br></li><li data-line="2">Materializing Continuous Aggregates: After defining continuous aggregates, you need to materialize them, which means computing the aggregations and storing the results. Materialization is performed automatically by TimescaleDB in the background based on the defined aggregation policies. In our example, TimescaleDB will calculate the average value for each sensor ID every hour and store the results in a separate table. The materialized continuous aggregates can be queried just like regular tables.<br></li><li data-line="6">Querying Continuous Aggregates: Once the continuous aggregates are materialized, you can query them directly to retrieve precomputed aggregated results. For example, to retrieve the average value for a specific sensor ID for the last 24 hours, you can execute the following SQL query:</li></ul></div><div><ol><li data-line="0">This query will retrieve the precomputed average values for the specified sensor ID for the last 24 hours without having to perform the aggregation calculations at query time.</li></ol></div><div><pre class="language-sql" tabindex="0"><code class="language-sql is-loaded"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> avg_value_hourly <span class="token keyword">WHERE</span> sensor_id <span class="token operator">=</span> <span class="token number">123</span> <span class="token operator">AND</span> <span class="token keyword">time</span> <span class="token operator">&gt;=</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">INTERVAL</span> <span class="token string">'24 hours'</span><span class="token punctuation">;</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p>By utilizing continuous aggregation in TimescaleDB, you can precompute and store frequently used aggregations, improving the query performance for time-based data analysis. It is particularly useful when you have large volumes of data and need to calculate aggregations over specific time intervals.</p></div><div><p>I have a screen that sends request continuously. I want to aggregate all the request counts and also sometimes it's counted as successful count. So I want to aggregate the successful count as well. On Hourly, Monthly, Weekly and Monthly basis.</p></div><div><p>To aggregate the request counts and successful counts on an hourly, daily, weekly, and monthly basis, you can use continuous aggregation in TimescaleDB. Here's an example of how you can achieve this:</p></div><div><ol><li data-line="0">Create a Hypertable: Start by creating a hypertable to store your time-series data. The hypertable should include columns such as "timestamp" (representing the time of each request), "request_count" (the total number of requests), and "successful_count" (the count of successful requests).</li></ol></div><div><p>sql</p></div><div><pre class="language-sql" tabindex="0"><code class="language-sql is-loaded"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> request_data <span class="token punctuation">(</span>
<span class="token keyword">timestamp</span>        TIMESTAMPTZ       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
request_count    <span class="token keyword">INTEGER</span>           <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
successful_count <span class="token keyword">INTEGER</span>           <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token comment">-- Additional columns... </span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- Create a hypertable on the 'timestamp' column </span>
<span class="token keyword">SELECT</span> create_hypertable<span class="token punctuation">(</span><span class="token string">'request_data'</span><span class="token punctuation">,</span> <span class="token string">'timestamp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><ol start="2"><li data-line="0">Define Continuous Aggregates: Define continuous aggregates to calculate the request counts and successful counts at different time intervals. You can use aggregate functions like <code>SUM</code> and <code>COUNT</code> to calculate the totals.</li></ol></div><div><pre class="language-sql" tabindex="0"><code class="language-sql is-loaded"><span class="token comment">-- Aggregate request counts every hour </span>
<span class="token keyword">SELECT</span> add_continuous_aggregate_policy<span class="token punctuation">(</span><span class="token string">'request_data'</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token string">'1 hour'</span><span class="token punctuation">,</span> <span class="token string">'hourly_request_count'</span><span class="token punctuation">,</span> <span class="token string">'SELECT time_bucket(\'1 hour\', timestamp) AS hour, SUM(request_count) AS count FROM request_data GROUP BY hour'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">-- Aggregate successful counts every hour </span>
<span class="token keyword">SELECT</span> add_continuous_aggregate_policy<span class="token punctuation">(</span><span class="token string">'request_data'</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token string">'1 hour'</span><span class="token punctuation">,</span> <span class="token string">'hourly_successful_count'</span><span class="token punctuation">,</span> <span class="token string">'SELECT time_bucket(\'1 hour\', timestamp) AS hour, SUM(successful_count) AS count FROM request_data GROUP BY hour'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">-- Aggregate request counts every day </span>
<span class="token keyword">SELECT</span> add_continuous_aggregate_policy<span class="token punctuation">(</span><span class="token string">'request_data'</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token string">'1 day'</span><span class="token punctuation">,</span> <span class="token string">'daily_request_count'</span><span class="token punctuation">,</span> <span class="token string">'SELECT time_bucket(\'1 day\', timestamp) AS day, SUM(request_count) AS count FROM request_data GROUP BY day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">-- Aggregate successful counts every day </span>
<span class="token keyword">SELECT</span> add_continuous_aggregate_policy<span class="token punctuation">(</span><span class="token string">'request_data'</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token string">'1 day'</span><span class="token punctuation">,</span> <span class="token string">'daily_successful_count'</span><span class="token punctuation">,</span> <span class="token string">'SELECT time_bucket(\'1 day\', timestamp) AS day, SUM(successful_count) AS count FROM request_data GROUP BY day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">-- Similar policies can be defined for weekly and monthly aggregates</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p>In the above example, four continuous aggregates are defined: two for request counts and two for successful counts, at hourly and daily intervals. You can define additional policies for weekly and monthly aggregates using the respective time intervals.</p></div><div><ol start="3"><li data-line="0">Materialize Continuous Aggregates: TimescaleDB will automatically materialize the continuous aggregates based on the defined policies. The materialization process will compute the aggregates and store the results in separate tables.</li><li data-line="2">Querying Continuous Aggregates: Once the continuous aggregates are materialized, you can query them to retrieve the precomputed aggregated results. For example, to retrieve the hourly request counts:</li></ol></div><div><pre class="language-sql" tabindex="0"><code class="language-sql is-loaded"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> hourly_request_count<span class="token punctuation">;</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p>This query will return the hourly request counts along with the corresponding time intervals. You can apply similar queries to retrieve the other aggregates like successful counts.</p></div><div><p>By using continuous aggregates in TimescaleDB, you can efficiently aggregate and store the request counts and successful counts on different time intervals, allowing for faster querying and analysis of your time-series data.</p></div><div><p>If the table already exists, will it automatically aggregate data for the first time.</p></div><div><p>No, if the table already exists and contains historical data, TimescaleDB's continuous aggregation feature will not automatically aggregate the existing data for the first time. Continuous aggregates are applied only to new incoming data after the continuous aggregate policies are defined.</p></div><div><p>To aggregate the existing data and populate the continuous aggregates for the historical data, you can use TimescaleDB's "chunk-aware" feature called "retroactively." Retroactively allows you to perform aggregate computations on existing data and populate the continuous aggregates accordingly.</p></div><div><p>Here's an example of how you can use retroactively to populate the continuous aggregates for existing data:</p></div><div><pre class="language-sql" tabindex="0"><code class="language-sql is-loaded"><span class="token comment">-- Enable retroactively for the hypertable </span>
<span class="token keyword">SELECT</span> add_continuous_aggregate_policy<span class="token punctuation">(</span><span class="token string">'request_data'</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token string">'1 hour'</span><span class="token punctuation">,</span> <span class="token string">'hourly_request_count'</span><span class="token punctuation">,</span> <span class="token string">'SELECT time_bucket(\'1 hour\', timestamp) AS hour, SUM(request_count) AS count FROM request_data GROUP BY hour'</span><span class="token punctuation">,</span> start_offset <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">INTERVAL</span> <span class="token string">'7 days'</span><span class="token punctuation">,</span> end_offset <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">INTERVAL</span> <span class="token string">'1 hour'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Repeat the above command for other continuous aggregate policies as needed</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p>In the above example, the <code>start_offset</code> and <code>end_offset</code> parameters specify the range of historical data to include in the retroactive aggregation. Adjust these offsets based on your specific data and requirements. By defining the continuous aggregate policies with retroactively enabled, TimescaleDB will perform aggregate computations on the existing data and populate the continuous aggregates accordingly.</p></div><div><p>Keep in mind that retroactively aggregating large amounts of historical data can be resource-intensive and may take some time depending on the volume of data. It's recommended to schedule and execute retroactive aggregation during periods of lower system activity or perform it in batches to manage resource usage effectively.</p></div><div><p>After the retroactive aggregation is complete, the continuous aggregates will be populated with the aggregated results for the historical data, and new incoming data will continue to be aggregated based on the defined policies.</p></div><div><hr></div><div><p>Thanks for reading!</p></div><div class="mod-footer"></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-gutter"><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-container"><div class="sidebar-sizer"><div class="sidebar-content-positioner"><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder"><div class="graph-view-container"><div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div><canvas id="graph-canvas" width="512px" height="512px"></canvas></div></div></div><div class="tree-container outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area"></div></div></div></div></div></div></div></div></body></html>